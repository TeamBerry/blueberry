<div class="row justify-content-center">
    <h2 class="admin-tab-title">Boxes</h2>
    <div class="d-flex box-manager">
        <div class="col-2 box-list px-0">
            <div id="box-list-container">
                <div *ngFor="let box of boxes" class="box-list-item p-3"
                    [ngClass]="{'active': box._id === selectedBox?._id}" (click)="selectBox(box._id)">
                    <div class="d-flex">
                        <div class="col px-0">
                            <div class="d-flex align-items-center">
                                <app-box-status-indicator [isOpen]="box?.open" class="me-2"></app-box-status-indicator>
                                <p class="mb-0 box-name">{{ box?.name }}</p>
                            </div>
                            <div class="modes">
                                <app-bx-chip [options]="{'type': 'random'}" [display]="'icon'"
                                    *ngIf="box?.options?.random"></app-bx-chip>
                                <app-bx-chip [options]="{'type': 'loop'}" [display]="'icon'" *ngIf="box?.options?.loop">
                                </app-bx-chip>
                                <app-bx-chip [options]="{'type': 'lock'}" [display]="'icon'" *ngIf="box?.private">
                                </app-bx-chip>
                                <app-bx-chip [options]="{'type': 'coin-enabled'}" [display]="'icon'"
                                    *ngIf="box?.options?.berries">
                                </app-bx-chip>
                                <app-bx-chip
                                    [options]="{'type': 'duration-limit', 'tooltipText': 'Videos longer than ' + box.options.videoMaxDurationLimit + ' mins will be rejected.'}"
                                    [display]="'icon'" *ngIf="box?.options?.videoMaxDurationLimit !== 0">
                                </app-bx-chip>
                            </div>
                        </div>
                        <div class="col-1 p-0 m-auto text-center h-100 d-flex" ngbDropdown container="body">
                            <div ngbDropdownToggle>
                                <svg class="berrybox-svg" style="height: 30px; width: 30px;"
                                    xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500">
                                    <rect class="berrybox-path" x="183.33" y="183.33" width="133.33" height="133.33"
                                        rx="10" />
                                    <rect class="berrybox-path" x="183.33" y="27.67" width="133.33" height="133.33"
                                        rx="10" />
                                    <rect class="berrybox-path" x="183.33" y="339" width="133.33" height="133.33"
                                        rx="10" />
                                </svg>
                            </div>
                            <div ngbDropdownMenu>
                                <a ngbDropdownItem href="box/{{ box?._id }}" type="button">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"
                                        class="berrybox-svg bx-dropdown-icon">
                                        <defs>
                                            <style>
                                                .a2f5db06-311b-495b-b36a-cad036153f22 {
                                                    stroke-linecap: round;
                                                    stroke-miterlimit: 10;
                                                    stroke-width: 40px;
                                                }
                                            </style>
                                        </defs>
                                        <path class="berrybox-path"
                                            d="M282,245.72l-92.17-66.21a5.28,5.28,0,0,0-8.35,4.29V316.2a5.28,5.28,0,0,0,8.35,4.29L282,254.28A5.27,5.27,0,0,0,282,245.72Z" />
                                        <rect class="berrybox-path" x="51.43" y="217.97" width="162.42" height="64.05"
                                            rx="5.27" />
                                        <line class="a2f5db06-311b-495b-b36a-cad036153f22 berrybox-stroke" x1="247.04"
                                            y1="73.41" x2="428.57" y2="73.41" />
                                        <line class="a2f5db06-311b-495b-b36a-cad036153f22 berrybox-stroke" x1="428.57"
                                            y1="73.41" x2="428.57" y2="426.52" />
                                        <line class="a2f5db06-311b-495b-b36a-cad036153f22 berrybox-stroke" x1="247.04"
                                            y1="426.52" x2="428.57" y2="426.52" />
                                        <line class="a2f5db06-311b-495b-b36a-cad036153f22 berrybox-stroke" x1="247.04"
                                            y1="340.03" x2="247.04" y2="426.59" />
                                        <line class="a2f5db06-311b-495b-b36a-cad036153f22 berrybox-stroke" x1="247.04"
                                            y1="73.9" x2="247.04" y2="160.46" />
                                    </svg>
                                    <span>Enter</span>
                                </a>
                                <button ngbDropdownItem (click)="openCreateModal(box)">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"
                                        class="berrybox-svg bx-dropdown-icon">
                                        <path class="berrybox-path"
                                            d="M345.2,68.73h57.89a0,0,0,0,1,0,0V190.16a0,0,0,0,1,0,0H345.2a6.47,6.47,0,0,1-6.47-6.47V75.2a6.47,6.47,0,0,1,6.47-6.47Z"
                                            transform="translate(724.72 -41.3) rotate(135)" />
                                        <polygon class="berrybox-path"
                                            points="66.08 433.56 168.78 416.73 82.92 330.86 66.08 433.56" />
                                        <rect class="berrybox-path" x="95.51" y="201.19" width="284.46" height="121.43"
                                            transform="translate(591.04 279) rotate(135)" />
                                    </svg>
                                    <span>Edit</span>
                                </button>
                                <button ngbDropdownItem (click)="toggleBoxState(box)">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"
                                        class="berrybox-svg bx-dropdown-icon">
                                        <defs>
                                            <style>
                                                .a81cd0ea-0b0d-4620-b84c-4e7d6c0ee550 {
                                                    stroke-linecap: round;
                                                    stroke-miterlimit: 10;
                                                    stroke-width: 60px;
                                                }
                                            </style>
                                        </defs>
                                        <path class="a81cd0ea-0b0d-4620-b84c-4e7d6c0ee550 berrybox-stroke"
                                            d="M148.76,200.74a146.53,146.53,0,1,0,202.48,0" />
                                        <rect class="berrybox-path" x="141.08" y="124.68" width="217.84" height="62.1"
                                            rx="11.1" transform="translate(94.28 405.72) rotate(-90)" />
                                    </svg>
                                    <span>{{ box.open ? 'Close': 'Open' }}</span>
                                </button>
                                <button ngbDropdownItem (click)="deleteBox(box)" *ngIf="!box.open">
                                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 500 500"
                                        class="berrybox-svg bx-dropdown-icon">
                                        <defs>
                                            <style>
                                                .a80cec86-9a1c-46d3-bf58-01bf0358db95 {
                                                    stroke-miterlimit: 10;
                                                    stroke-width: 33px;
                                                }
                                            </style>
                                        </defs>
                                        <path class="a80cec86-9a1c-46d3-bf58-01bf0358db95 berrybox-path berrybox-stroke"
                                            d="M356.12,455H158.81c-10.49,0-19-11.2-19-25L105.74,129.35h299L375.1,430C375.1,443.81,366.6,455,356.12,455Z" />
                                        <path class="berrybox-path"
                                            d="M60.7,56.31h389a8.59,8.59,0,0,1,8.59,8.59V88.14a0,0,0,0,1,0,0H52.12a0,0,0,0,1,0,0V64.89A8.59,8.59,0,0,1,60.7,56.31Z" />
                                        <rect class="berrybox-path" x="189.07" y="30.02" width="132.29" height="52.57"
                                            rx="20.87" />
                                    </svg>
                                    <span>Delete</span>
                                </button>
                            </div>
                        </div>
                    </div>
                    <div *ngIf="box.featured">
                        <p class="featured-indicator mb-0">Featured until
                            <span>{{ box.featured | date:'dd/MM/yyyy HH:mm:ss' }}</span>
                        </p>
                    </div>
                    <div *ngIf="!box.open">
                        <p class="deletion-indicator mb-0">Scheduled for deletion on
                            <span>{{ setDeletionDate(box.updatedAt) | date:'dd/MM/yyyy HH:mm:ss' }}</span>
                        </p>
                    </div>
                </div>
            </div>
            <div class="px-2 pb-2 d-grid">
                <button class="btn btn-primary" (click)="openCreateModal()">
                    Create a box
                </button>
            </div>
        </div>
        <div class="col box-panel px-0">
            <div *ngIf="selectedBox; else noBox" class="h-100">
                <div class="box-stats-banner d-flex mx-2">
                    <div class="box-stat" id="box-lifetime">
                        <p class="mb-0 stat-title">Life</p>
                        <span *ngIf="lifetime">{{ lifetime | duration }}</span>
                    </div>
                    <div class="box-stat" id="box-users">
                        <p class="mb-0 stat-title">Current Users</p>
                        <span *ngIf="users !== null">{{ users }}</span>
                    </div>
                    <div class="box-stat" id="box-users">
                        <p class="mb-0 stat-title">Videos</p>
                        <span *ngIf="selectedBoxQueueLength">{{ selectedBoxQueueLength }}</span>
                    </div>
                </div>
                <div class="d-flex pt-1 h-100">
                    <div class="col-4 ps-2 pe-1">
                        <div class="chat-space mb-2">
                            <div class="half-panel" id="chat-panel">
                                <app-chat-tab class="fixed-tab" *ngIf="selectedBox" [boxToken]="selectedBox?._id"
                                    [user]="user"></app-chat-tab>
                            </div>
                        </div>
                        <div class="player-space mt-2">
                            <div class="panel-tab-title-section">
                                <p class="panel-tab-title col">Player</p>
                            </div>
                            <app-player *ngIf="selectedBox && selectedBox.open" [boxToken]="selectedBox._id">
                            </app-player>
                        </div>
                    </div>
                    <div class="col-4 px-1">
                        <app-queue class="fixed-tab playlist-space" *ngIf="selectedBox" [user]="user"
                            [box]="selectedBox" [permissions]="permissions">
                        </app-queue>
                    </div>
                    <div class="col-4 ps-1 pe-2">
                        <app-userlist *ngIf="selectedBox" [box]="selectedBox" [user]="user"
                            class="fixed-tab search-space" [permissions]="permissions">
                        </app-userlist>
                    </div>
                </div>
            </div>
            <ng-template #noBox>
                <div class="h-100 d-flex align-items-center justify-content-center">
                    <p class="text-muted text-center" style="font-size: 2rem;">Create or select a box to enable the
                        display</p>
                </div>
            </ng-template>
        </div>
    </div>
</div>